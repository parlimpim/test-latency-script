import json
import requests

# Note: original query string below. It seems impossible to parse and
# reproduce query strings 100% accurately so the one below is given
# in case the reproduced version is not "correct".
#response = requests.post('http://localhost:3000/api/2/6213a4789ba6d31278d16d9b/rest/pipeline/update/6213af7977bdf753fcd4adb9?duplicate_check=True', headers=headers, cookies=cookies, data=data)

def update_pipeline(host: str, org_id: str, token: str,snode_id: str):
    endpoint = f'{host}/api/2/{org_id}/rest/pipeline/update/{snode_id}'
    headers = {
        'Authorization': token,
        'Content-Type': 'application/json; charset=UTF-8',
    }
    params = { 'duplicate_check': True }
    data = {"update_map":{"create":{"snap":{"x164":{"class_fqid":"com-snaplogic-snaps-rest-get_2-main14627","class_id":"com-snaplogic-snaps-rest-get","class_version":2,"instance_fqid":"x164_1","instance_version":1,"property_map":{"info":{"notes":{},"label":{"value":"REST Get"}},"view_serial":100,"account":{"account_ref":{"value":{}}},"input":{"input0":{"label":{"value":"input0"},"view_type":{"value":"document"}}},"settings":{"retryInterval":{"value":3},"trustAllCerts":{"value":False},"execution_mode":{"value":"Validate & Execute"},"retry":{"value":5},"hasNext":{"expression":True,"value": None},"serviceUrl":{"expression":False,"value":"https://www.google.com"},"processArray":{"value":False},"retryPolicy":{"value":"Connection errors"},"showAllHeaders":{"value":False},"paginationInterval":{"value":0},"executeDuringPreview":{"value":True},"normalizeUri":{"value":True},"header":{"value":[]},"responseEntityType":{"value":"DEFAULT"},"followRedirects":{"value":True},"timeout":{"value":900},"connTimeout":{"value":30},"nextUrl":{"expression":True,"value":None},"queryParams":{"value":[]},"rawData":{"value":False}},"error":{"error0":{"label":{"value":"error0"},"view_type":{"value":"document"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"label":{"value":"output0"},"view_type":{"value":"document"}}}},"class_build_tag":"main14627","client_id":"x164"},"x165":{"class_fqid":"com-snaplogic-snaps-transform-datatransform_4-main14627","class_id":"com-snaplogic-snaps-transform-datatransform","class_version":4,"instance_fqid":"x165_1","instance_version":9,"property_map":{"info":{"notes":{},"label":{"value":"Mapper"}},"view_serial":100,"input":{"input0":{"view_type":{"value":"document"},"label":{"value":"input0"}}},"settings":{"NoneSafeAccess":{"value":False},"passThrough":{"value":False},"execution_mode":{"value":"Validate & Execute"},"transformations":{"value":{"mappingTable":{"value":[{"expression":{"expression":True,"value":"$headers.date"},"targetPath":{"value":"$date"}},{"expression":{"expression":True,"value":"$headers.server"},"targetPath":{"value":"$server"}}]},"mappingRoot":{"value":"$"}}}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"view_type":{"value":"document"},"label":{"value":"output0"}}}},"class_build_tag":"main14627","client_id":"x165"},"x166":{"class_fqid":"com-snaplogic-snaps-transform-csvformatter_3-main14627","class_id":"com-snaplogic-snaps-transform-csvformatter","class_version":3,"instance_fqid":"x166_1","instance_version":1,"property_map":{"info":{"label":{"value":"CSV Formatter"}},"view_serial":100,"input":{"input0":{"label":{"value":"input0"},"view_type":{"value":"document"}}},"settings":{"execution_mode":{"value":"Validate & Execute"},"escapeChar":{"value":"\\"},"quoteMode":{"value":"ALL"},"quoteCharacter":{"value":"\""},"writeHeader":{"value":True},"charset":{"value":"UTF-8"},"ignoreEmptyStream":{"value":False},"writeBOM":{"value":False},"delimiter":{"value":","},"errorPolicy":{"value":"Default"},"newlineCharacter":{"value":"LF"},"useDefinedHeader":{"value":False},"outputHeader":{"value":[{"expression":{"expression":True,"value":""}}]}},"error":{"error0":{"label":{"value":"error0"},"view_type":{"value":"document"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"label":{"value":"output0"},"view_type":{"value":"binary"}}}},"class_build_tag":"main14627","client_id":"x166"},"x167":{"class_fqid":"com-snaplogic-snaps-binary-write_3-main14627","class_id":"com-snaplogic-snaps-binary-write","class_version":3,"instance_fqid":"x167_1","instance_version":1,"property_map":{"info":{"notes":{},"label":{"value":"File Writer"}},"view_serial":100,"account":{"account_ref":{"value":{}}},"settings":{"retryInterval":{"expression":False,"value":1},"retries":{"expression":False,"value":0},"execution_mode":{"value":"Execute only"},"flushIntervalKb":{"value":-1},"writeHeader":{"value":False},"cannedAcls":{"value":"Private"},"createDir":{"value":False},"executable_during_suggest":{"value":False},"filename":{"expression":False,"value":"google_header.csv"},"writeEmptyFile":{"value":False},"UserPermissionsKey":{"value":[]},"advancedProperties":{"value":[]},"validate":{"value":False},"fileAction":{"value":"OVERWRITE"}},"output":{},"error":{"error0":{"label":{"value":"error0"},"view_type":{"value":"document"}},"error_behavior":{"value":"fail"}},"input":{"input0":{"label":{"value":"input0"},"view_type":{"value":"binary"}}}},"class_build_tag":"main14627","client_id":"x167"}},"link":{"link100":{"dst_id":"x167","dst_view_id":"input0","src_id":"x166","src_view_id":"output0"},"link101":{"dst_id":"x165","dst_view_id":"input0","src_id":"x164","src_view_id":"output0"},"link102":{"dst_id":"x166","dst_view_id":"input0","src_id":"x165","src_view_id":"output0"}}},"update":{"snap":{},"link":{},"render_map":{"pan_x_num":0,"default_snaplex":"6213a53477bdf753fcd49b37","scale_ratio":1,"detail_map":{"x164":{"grid_x_int":4,"grid_y_int":2,"rot_int":0,"recommendation_id":None,"source":"","index":None,"rot_tail_int":0,"output":{},"input":{}},"x165":{"grid_x_int":5,"grid_y_int":2,"rot_int":0,"recommendation_id":None,"source":"","index":None,"rot_tail_int":0,"output":{},"input":{}},"x166":{"grid_x_int":6,"grid_y_int":2,"rot_int":0,"recommendation_id":None,"source":"","index":None,"rot_tail_int":0,"output":{},"input":{}},"x167":{"grid_x_int":7,"grid_y_int":2,"rot_int":0,"recommendation_id":None,"source":"","index":None,"rot_tail_int":0,"output":{},"input":{}}},"pan_y_num":0},"pipeline":{"info":{"notes":{"value":None},"label":{"value":"new"},"purpose":{"value":None},"pipeline_doc_uri":{"value":None},"author":{"value":"admin@snaplogic.com"}},"error":{"error_behavior":{"value":"none"}},"settings":{"param_table":{"value":[]},"suspendable":{"value":False},"test_pipeline":{"value":False},"imports":{"value":[]},"error_param_table":{"value":[]},"error_pipeline":{"expression":False,"value":None}},"instance_version":1,"input":{"x164_input0":{"label":{"value":"REST Get - input0"},"view_type":{"value":"document"}}},"output":{}}},"delete":{"snap":[],"link":[]},"link_serial":103}}
    response = requests.post(endpoint, headers=headers, params=params, data=json.dumps(data))
    print(response.status_code)
    print(response.json())

